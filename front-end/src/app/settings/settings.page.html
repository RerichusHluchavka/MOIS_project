<ion-header>
  <ion-toolbar>
    <ion-title>Settings</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">

  <!-- ===================== -->
  <!-- APPEARANCE -->
  <!-- ===================== -->
  <ion-card>
    <ion-card-header>
      <ion-card-title>Appearance</ion-card-title>
    </ion-card-header>

    <ion-card-content>
      <ion-list>

        <!-- Follow system -->
        <ion-item>
          <ion-icon slot="start" name="desktop-outline"></ion-icon>
          <ion-label>
            <h2>Follow system theme</h2>
            <p>Use system light / dark mode</p>
          </ion-label>
          <ion-toggle
            [(ngModel)]="followSystem"
            (ionChange)="onSystemToggle(followSystem)">
          </ion-toggle>
        </ion-item>

        <!-- Dark mode -->
        <ion-item>
          <ion-icon slot="start" name="moon-outline"></ion-icon>
          <ion-label>
            <h2>Dark mode</h2>
            <p>Manual theme switch</p>
          </ion-label>
          <ion-toggle
            [(ngModel)]="darkMode"
            (ionChange)="onToggleTheme(darkMode)"
            [disabled]="followSystem">
          </ion-toggle>
        </ion-item>

      </ion-list>
    </ion-card-content>
  </ion-card>

  <!-- ===================== -->
  <!-- CURRENT USER -->
  <!-- ===================== -->
  <ion-card>
    <ion-card-header>
      <ion-card-title>Current user</ion-card-title>
    </ion-card-header>

    <ion-card-content>

      <!-- loading -->
      <div *ngIf="userLoading" class="ion-text-center ion-padding">
        <ion-spinner name="crescent"></ion-spinner>
      </div>

      <!-- error -->
      <ion-text color="danger" *ngIf="userError">
        {{ userError }}
      </ion-text>

      <!-- user info -->
      <ion-list *ngIf="!userLoading && currentUser">

        <ion-item>
          <ion-label>
            <strong>Username</strong>
          </ion-label>
          <ion-note slot="end">
            {{ currentUser.username }}
          </ion-note>
        </ion-item>

        <ion-item>
          <ion-label>
            <strong>Current role</strong>
          </ion-label>
          <ion-note slot="end">
            {{ currentUser.role }}
          </ion-note>
        </ion-item>

        <!-- role change â€“ only admin -->
        <ion-item *ngIf="currentUser.role === 'admin'">
          <ion-label position="stacked">
            Change role
          </ion-label>

          <ion-select
            interface="popover"
            [(ngModel)]="currentUser.role">

            <ion-select-option value="admin">admin</ion-select-option>
            <ion-select-option value="kitchen">kitchen</ion-select-option>
            <ion-select-option value="inventory">inventory</ion-select-option>
            <ion-select-option value="prison">prison</ion-select-option>

          </ion-select>

          <ion-button
            expand="block"
            class="ion-margin-top"
            (click)="changeRole()">
            Save role
          </ion-button>
        </ion-item>

        <!-- not admin info -->
        <ion-item *ngIf="currentUser.role !== 'admin'">
          <ion-note color="medium">
            You are not allowed to change roles.
          </ion-note>
        </ion-item>

      </ion-list>
    </ion-card-content>
  </ion-card>

</ion-content>
